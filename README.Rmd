---
output:
  html_document:
    highlight: tango
    keep_md: yes
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE)
```

## ![CTSgetR](https://github.com/dgrapov/CTSgetR/blob/master/inst/ctsgetR_logo.png?raw=true)

### R interface to the [Chemical Translation Service (CTS)](http://cts.fiehnlab.ucdavis.edu/)

#### `CTSgetR` provides a consitent interface to translation of chemical names and over 200 database identifiers including `InChIKey`, `HMDB`, `KEGG` and `PubChem`. Translation of chemical names is hard. Use `CTSgetR` to robustly translate chemical names to other identifiers through 1) conversion to `InChIKey` 2) `biological` or `popularity` scoring and 3) translation to over 200 biological database identifiers. `CTSgetR` uses a sqlite database to cache and speed all of your routine translations.

### Installation
```{r, message=FALSE,warning=FALSE,eval=FALSE}
install_github("dgrapov/CTSgetR")
```

### Make sure CTS API is available
```{r}
library(CTSgetR)
GET('https://cts.fiehnlab.ucdavis.edu/services') %>%
  http_status(.) %>%
  {if( .$category != 'Success'){stop('Oops looks like https://cts.fiehnlab.ucdavis.edu/services is down!') }} 
```

### View some of the possible translation options between > 200 databases
```{r}
trans<-unlist(valid_from())
head(trans,10)
```

### Find a database of interest
```{r}
want<-'CID'
trans[grepl(want,trans,ignore.case=TRUE)]
```


### Initialize a local database to speed up routine queries
```{r}
db_name<-'cts.sqlite'
init_CTSgetR_db(db_name)
db_stats()
```


### Translation examples

#### `Chemical Name` to `InChIKey`
```{r,message=FALSE}

id<-c("alanine",'lactic acid')
from<-"Chemical Name"
to<-"InChIKey"

CTSgetR(id,from,to,db_name)
```

#### One identifier to many
```{r}
id<-c("alanine",'lactic acid')
from<-"Chemical Name"
to<- c( "PubChem CID", "KEGG","Human Metabolome Database")

(out<-to %>%
  map(~CTSgetR(id,from,.,db_name)) 
  %>% do.call('rbind',.))


```



#### Many identifiers to one
```{r}

to<- "InChIKey"

(out2<-out %>%
  pmap_dfr(function(...) {
    tmp <- tibble(...)
    CTSgetR(tmp$key,tmp$to,to,db_name)
  
  }))

```